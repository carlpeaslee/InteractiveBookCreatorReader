/*! rsj.0.01.0 2016-04-15 */
var myApp=angular.module("myApp",["ngMaterial","ngMessages","ngRoute","ngSanitize"]);myApp.filter("sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),myApp.directive("dynamic",["$compile",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.dynamic,function(d){c.html(d),a(c.contents())(b)})}}}]),myApp.config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("purple")}]),myApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/admin",{templateUrl:"/assets/views/admin/main.html",controller:"AdminController"}).when("/readon",{templateUrl:"/assets/views/readon.html",controller:"ReadController"}).when("/read",{templateUrl:"/assets/views/aa/test.html",controller:"ReadController"}).when("/library",{templateUrl:"/assets/views/library/library.html",controller:"LibraryController"}).when("/journal",{templateUrl:"/assets/views/journal/journal.html",controller:"JournalController"}).when("/questions",{templateUrl:"/assets/views/questions/questions.html",controller:"QuestionsController"}).when("/profile",{templateUrl:"/assets/views/profile/profile.html",controller:"ProfileController"}).otherwise({redirectTo:"/"})}]),myApp.controller("AdminController",["$scope","$sce","$compile","$filter","AdminService","RSJService",function(a,b,c,d,e,f){var g=e;a.record=f.user.data.answers,a.newquestion={},a.newpage={},a.admin=g.admin,g.getQuestions(),a.submitNewQuestion=function(b){g.submitNewQuestion(b),a.newquestion={}},a.submitNewPage=function(b){g.submitNewPage(b),a.newpage={}}}]),myApp.controller("JournalController",["$scope","RSJService",function(a,b){a.journal={title:"",subDate:"",entry:""};var c="";a.todos=[{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"}]}]),myApp.controller("LibraryController",["$scope","$http","$location","RSJService",function(a,b,c,d){}]),myApp.controller("LoginController",["$scope","$http","$location","$mdDialog","$mdMedia","RSJService",function(a,b,c,d,e,f){var g=f;a.login=g.login,a.user=g.user,a.createUser=g.createUser,a.goToCreateUser=function(a){d.hide(),d.show({templateUrl:"assets/views/newuser.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})},a.backToLogin=function(a){d.hide(),d.show({templateUrl:"assets/views/login.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})}}]),myApp.controller("NavController",["$scope","$window","$http","$location","RSJService",function(a,b,c,d,e){var f=e;a.user=f.user}]),myApp.controller("ProfileController",["$scope","RSJService",function(a,b){var c=b;a.user=c.user,c.getUserData(),a.updateUserProfile=function(a){console.log("updateUserProfile fired"),c.postUserData(a)},a.states="AL AK AZ AR CA CO CT DE FL GA HI ID IL IN IA KS KY LA ME MD MA MI MN MS MO MT NE NV NH NJ NM NY NC ND OH OK OR PA RI SC SD TN TX UT VT VA WA WV WI WY".split(" ").map(function(a){return{abbrev:a}})}]),myApp.controller("QuestionsController",["$scope","RSJService",function(a,b){a.journal={title:"",subDate:"",entry:""};var c="";a.todos=[{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"}]}]),myApp.controller("ReadController",["$scope","$sce","$http","$location","$route","$routeParams","$compile","$timeout","RSJService",function(a,b,c,d,e,f,g,h,i){var j=i,k=0,l=0;a.setIndex=function(){for(var b=0;b<j.pages.data.length;b++)j.pages.data[b].order==j.user.data.currentpage&&(k=b,a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0])},a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0],a.answer1={prompt:"",answer:"",_id:""},console.log(a.answer1),a.setAnswer1=function(){if(j.pages.data[k].question1[0]){for(var b=0;b<j.user.data.answers.length;b++)j.user.data.answers[b]._id==j.pages.data[k].question1[0]._id?a.answer1.answer=j.user.data.answers[b].answer:a.answer1.answer="";a.answer1.prompt=j.pages.data[k].question1[0].prompt,a.answer1._id=j.pages.data[k].question1[0]._id,console.log(a.answer1)}else a.answer1.answer="",a.answer1.prompt="",a.answer1._id="",console.log(a.answer1)},a.setIndex(),a.setAnswer1(),a.pageForward=function(){console.log("pageForward fired"),j.user.data.currentpage++,a.setIndex(),a.setAnswer1()},a.pageBackward=function(){console.log("pageBackward fired"),j.user.data.currentpage--,a.setIndex(),a.setAnswer1()},a.autoSaveAnswers=function(b){console.log("autoSaveAnswers fired",b),j.user.data.answers[l].answer=a.answer1.answer,j.autoSaveAnswers(b)};var m=2,n=null,o=function(){a.answer1.answer&&j.autoSaveAnswers(a.answer1)},p=function(a,b){a!=b&&(n&&h.cancel(n),n=h(o,1e3*m))};a.$watch("answer1.answer",p)}]),myApp.controller("UserController",["$scope","$http","$location","$mdDialog","$mdMedia","$location","RSJService",function(a,b,c,d,e,c,f){var g=f;a.login=g.login,a.createUser=g.createUser,a.user=g.user,g.loginStatus(),a.goToCreateUser=function(){d.hide(),d.show({templateUrl:"assets/views/newuser.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1})},a.goToLogin=function(){d.hide(),g.showLoginDialog()}}]),myApp.factory("AdminService",["$http",function(a){var b=function(){a.get("/auth/user/admin/questions").then(function(a){g.questions=a.data})},c=function(c){a.post("/auth/user/admin/newquestion",c).then(function(a){b()})},d=function(){a.get("/auth/user/admin/pages").then(function(a){g.pages=a.data})},e=function(b){a.post("/auth/user/admin/newpage",b).then(function(a){d()})},f=function(){void 0===g.questions&&b()},g={};return{getQuestions:b,submitNewQuestion:c,getPages:d,submitNewPage:e,initialCall:f,admin:g}}]),myApp.factory("RSJService",["$http","$mdDialog","$location",function(a,b,c){var d={},e={},f={},g=function(){console.log("getPages fired"),a.get("/auth/user/pages").then(function(a){e.data=a.data,console.log("rsjService.pages.data :",e.data)})},h=function(){console.log("getUserData fired"),a.get("/auth/user/data").then(function(a){d.data=a.data,console.log("rsjService.user.data :",d.data)})},i=function(b){console.log("postUserData fired and sent:",b),a.post("/auth/user/data",b).then(function(a){h()})},j=function(b){console.log("autoSaveAnswers fired and sent:",b),a.post("/auth/user/autosave",b).then(function(a){console.log("response from autosave",a),d.data=a.data})},k=function(b){console.log("autoSaveCurrentPage fired"),a.post("/auth/user/currentpage",b).then(function(a){console.log("response from autoSaveCurrentPage",a),d.data=a.data})},l=function(){console.log("getQuestions fired"),a.get("/auth/user/admin/questions").then(function(a){f.allQuestions=a.data,console.log("rsjService.site.allQuestions was set to",f.allQuestions)})},m=function(){console.log("checking user login status"),a.get("/login").then(function(a){a.data!==!0?(console.log("NOT LOGGED IN!"),d.isLoggedIn=!1,n()):(console.log("LOGGED IN! ",a.data),d.isLoggedIn=!0,h(),g(),l(),c.path("/library"),b.hide())})},n=function(a){b.show({templateUrl:"assets/views/login.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})},o=function(b){console.log("login fired"),a.post("/login",b).then(function(a){m()})},p=function(b){console.log("createUser fired"),a.post("/register",b).then(function(a){})};return{loginStatus:m,login:o,createUser:p,postUserData:i,getUserData:h,getPages:g,user:d,pages:e,site:f,getQuestions:l,autoSaveAnswers:j,autoSaveCurrentPage:k}}]);