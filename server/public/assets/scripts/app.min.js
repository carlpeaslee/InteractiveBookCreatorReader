/*! rsj.0.01.0 2016-05-04 */
var myApp=angular.module("myApp",["ngMaterial","ngMessages","ngRoute","ngSanitize"]);myApp.filter("sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),myApp.directive("dynamic",["$compile",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.dynamic,function(d){c.html(d),a(c.contents())(b)})}}}]),myApp.config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("purple")}]),myApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/library",{templateUrl:"/assets/views/library/library.html",controller:"LibraryController",controllerAs:"lib"}).when("/login",{templateUrl:"/assets/views/library/library.html",controller:"UserController"}).when("/create",{templateUrl:"/assets/views/create/createmain.html",controller:"CreateController",controllerAs:"create"}).when("/read",{templateUrl:"/assets/views/aa/test.html",controller:"ReadController"}).when("/sass/:page",{templateUrl:"/assets/views/aa/sasstest2.html",controller:"NewRead"}).when("/journal",{templateUrl:"/assets/views/journal/journal.html",controller:"JournalController"}).when("/questions",{templateUrl:"/assets/views/questions/questions.html",controller:"QuestionsController"}).when("/:book/:page",{templateUrl:"/assets/views/library/dynamicbook.html",controller:"DynamicReadCtrl",controllerAs:"dread"}).when("/profile",{templateUrl:"/assets/views/profile/profile.html",controller:"ProfileController"}),b.html5Mode(!0)}]),myApp.controller("CreateController",["$scope","$sce","$compile","$filter","RSJService",function(a,b,c,d,e){var f=this,g=e;f.user=g.user,f.submitNewQuestion=g.saveNewQuestion,f.submitNewBook=g.saveNewBook,f.submitNewPage=g.saveNewPage}]),myApp.controller("DynamicReadCtrl",["$scope","$sce","$http","$location","$route","$routeParams","$compile","$timeout","$mdToast","RSJService",function(a,b,c,d,e,f,g,h,i,j){var k,l=j,m=this,n={};m.pageObject={},l.user.data.currentbook=f.book;var o=function(){p(),q(),r(),s()},p=function(){if("liblink"==f.page)for(var a=0;a<l.user.data.allprogress.length;a++)if(l.user.data.allprogress[a].linktitle==l.user.data.currentbook)return l.user.data.currentpage=l.user.data.allprogress[a].pnumber,void console.log("liblinkHandler set currentpage and routeParams.page to::",l.user.data.currentpage)},q=function(){console.log("setBookObject fired using currentbook:",l.user.data.currentbook);for(var a=0;a<l.user.data.books.length;a++)l.user.data.books[a].linktitle==l.user.data.currentbook&&(n=l.user.data.books[a],console.log("setBookObject set this book:",n))},r=function(){console.log("setPageDex fired using currentpage",l.user.data.currentpage);for(var a=!0,b=0;b<n.pages.length;b++)if(console.log("page for loop comparing:",n.pages[b].pnumber,l.user.data.currentpage),"new"==l.user.data.currentpage&&(k=0),n.pages[b].pnumber==l.user.data.currentpage)return k=parseInt(n.pages[b].pdex),console.log("pageDex:",k),void(a=!1);a===!0&&(k=0,i.show(i.simple().textContent("Let's start at the beginning").parent(angular.element(document.getElementsByClassName("newpage")))))},s=function(){for(var a=0;a<n.pages.length;a++)if(parseInt(n.pages[a].pdex)==k)return m.pageObject=n.pages[a],m.html=n.pages[a].content[0],l.user.data.currentpage=n.pages[a].pnumber,e.updateParams({page:n.pages[a].pnumber}),void console.log("pageObject",m.pageObject)};m.pageForward=function(){console.log("pageForward");for(var a=!1,b=0;b<n.pages.length;b++){if(console.log("pageForward comparing",parseInt(n.pages[b].pdex),k),parseInt(n.pages[b].pdex)==k+1)return k=parseInt(n.pages[b].pdex),m.pageObject=n.pages[b],m.html=n.pages[b].content[0],e.updateParams({page:n.pages[b].pnumber}),void(l.user.data.currentpage=n.pages[b].pnumber);a=!0}a===!0&&i.show(i.simple().textContent("You're at the end.").parent(angular.element(document.getElementsByClassName("newpage"))))},m.pageBackward=function(){console.log("pageBackward");for(var a=!1,b=0;b<n.pages.length;b++){if(parseInt(n.pages[b].pdex)==k-1)return k=parseInt(n.pages[b].pdex),m.pageObject=n.pages[b],m.html=n.pages[b].content[0],e.updateParams({page:n.pages[b].pnumber}),void(l.user.data.currentpage=n.pages[b].pnumber);a=!0}a===!0&&i.show(i.simple().textContent("You're at the beginning.").parent(angular.element(document.getElementsByClassName("newpage"))))},o()}]),myApp.controller("JournalController",["$scope","RSJService",function(a,b){a.journal={title:"",subDate:"",entry:""};var c="";a.todos=[{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"}]}]),myApp.controller("LibraryController",["$scope","$http","$location","RSJService",function(a,b,c,d){var e=this,f=d;e.user=f.user,f.refreshUserData().then(function(a){e.currentpage=f.user.data.currentpage})}]),myApp.controller("LoginController",["$scope","$mdToast","$http","$location","$mdDialog","$mdMedia","RSJService",function(a,b,c,d,e,f,g){var h=g;a.login=function(a){h.login(a)},a.loginAlert=h.loginAlert,a.user=h.user,a.createUser=h.createUser,a.goToCreateUser=function(a){e.hide(),e.show({templateUrl:"assets/views/newuser.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})},a.backToLogin=function(a){e.hide(),e.show({templateUrl:"assets/views/login.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})}}]),myApp.controller("NavController",["$scope","$window","$http","$location","RSJService",function(a,b,c,d,e){var f=e;a.user=f.user}]),myApp.controller("NewRead",["$scope","$sce","$http","$location","$route","$routeParams","$compile","$timeout","RSJService",function(a,b,c,d,e,f,g,h,i){var j=i,k=0,l=0;k=f.page;var m=function(){console.log("getPages fired from the read controller"),c.get("/auth/user/pages").then(function(b){j.pages.data=b.data,console.log("from getPages in ctrl, rsjService.pages.data :",j.pages.data),a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0],a.setIndex(),a.setAnswer1()})};m(),a.setIndex=function(){for(var b=0;b<j.pages.data.length;b++)j.pages.data[b].order==j.user.data.currentpage&&(k=b,a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0])},a.answer1={prompt:"",answer:"",_id:""},a.setAnswer1=function(){if(j.pages.data[k].question1[0]){for(var b=0;b<j.user.data.answers.length;b++)j.user.data.answers[b]._id==j.pages.data[k].question1[0]._id?a.answer1.answer=j.user.data.answers[b].answer:a.answer1.answer="";a.answer1.prompt=j.pages.data[k].question1[0].prompt,a.answer1._id=j.pages.data[k].question1[0]._id}else a.answer1.answer="",a.answer1.prompt="",a.answer1._id=""},a.pageForward=function(){console.log("pageForward fired"),j.user.data.currentpage++,a.setIndex(),a.setAnswer1(),j.autoSaveCurrentPage(j.user),e.updateParams({page:k})},a.pageBackward=function(){console.log("pageBackward fired"),j.user.data.currentpage--,a.setIndex(),a.setAnswer1(),j.autoSaveCurrentPage(j.user),e.updateParams({page:k})},a.autoSaveAnswers=function(b){console.log("autoSaveAnswers fired",b),j.user.data.answers[l].answer=a.answer1.answer,j.autoSaveAnswers(b)};var n=1,o=null,p=function(){a.answer1.answer&&j.autoSaveAnswers(a.answer1)},q=function(a,b){a!=b&&(o&&h.cancel(o),o=h(p,1e3*n))};a.$watch("answer1.answer",q),a.hits=[/blue/,/green/,/red/,/yellow/,/purple/,/brown/,/black/],a.print="a mystery",a.firstMatch=function(a,b,c){for(var d=0;d<b.length;d++)null!=b[d].exec(a)&&(c=b[d].exec(a)[0]);return c},a.toggle={a:{hit:/blue/,result:["cobalt","blueberry"]},b:{hit:/green/,result:["jade","dragonfly"]},c:{hit:/red/,result:["crimson","tomato"]}},a.togglePrint=["golden","popcorn cornel"],a.toggleMatch=function(a,b,c){for(var d in b)null!=b[d].hit.exec(a)&&(c=b[d].result);return c}}]),myApp.controller("ProfileController",["$scope","RSJService",function(a,b){var c=b;a.user=c.user,a.updateUserProfile=function(a){console.log("updateUserProfile fired"),c.postUserData(a)},a.states="AL AK AZ AR CA CO CT DE FL GA HI ID IL IN IA KS KY LA ME MD MA MI MN MS MO MT NE NV NH NJ NM NY NC ND OH OK OR PA RI SC SD TN TX UT VT VA WA WV WI WY".split(" ").map(function(a){return{abbrev:a}})}]),myApp.controller("QuestionsController",["$scope","RSJService",function(a,b){a.journal={title:"",subDate:"",entry:""};var c="";a.todos=[{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"},{face:c,what:"Brunch this weekend?",who:"Min Li Chan",when:"3:08PM",notes:" I'll be in your neighborhood doing errands"}]}]),myApp.controller("ReadController",["$scope","$sce","$http","$location","$route","$routeParams","$compile","$timeout","RSJService",function(a,b,c,d,e,f,g,h,i){var j=i,k=0,l=0;a.setIndex=function(){for(var b=0;b<j.pages.data.length;b++)j.pages.data[b].order==j.user.data.currentpage&&(k=b,a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0])},a.pageNow=j.pages.data[k],a.html=j.pages.data[k].content[0],a.answer1={prompt:"",answer:"",_id:""},console.log(a.answer1),a.setAnswer1=function(){if(j.pages.data[k].question1[0]){for(var b=0;b<j.user.data.answers.length;b++)j.user.data.answers[b]._id==j.pages.data[k].question1[0]._id?a.answer1.answer=j.user.data.answers[b].answer:a.answer1.answer="";a.answer1.prompt=j.pages.data[k].question1[0].prompt,a.answer1._id=j.pages.data[k].question1[0]._id,console.log(a.answer1)}else a.answer1.answer="",a.answer1.prompt="",a.answer1._id="",console.log(a.answer1)},a.setIndex(),a.setAnswer1(),a.pageForward=function(){console.log("pageForward fired"),j.user.data.currentpage++,a.setIndex(),a.setAnswer1(),j.autoSaveCurrentPage(j.user)},a.pageBackward=function(){console.log("pageBackward fired"),j.user.data.currentpage--,a.setIndex(),a.setAnswer1(),j.autoSaveCurrentPage(j.user)},a.autoSaveAnswers=function(b){console.log("autoSaveAnswers fired",b),j.user.data.answers[l].answer=a.answer1.answer,j.autoSaveAnswers(b)};var m=1,n=null,o=function(){a.answer1.answer&&j.autoSaveAnswers(a.answer1)},p=function(a,b){a!=b&&(n&&h.cancel(n),n=h(o,1e3*m))};a.$watch("answer1.answer",p),a.hits=[/blue/,/green/,/red/,/yellow/,/purple/,/brown/,/black/],a.print="a mystery",a.firstMatch=function(a,b,c){for(var d=0;d<b.length;d++)null!=b[d].exec(a)&&(c=b[d].exec(a)[0]);return c},a.toggle={a:{hit:/blue/,result:["cobalt","blueberry"]},b:{hit:/green/,result:["jade","dragonfly"]},c:{hit:/red/,result:["crimson","tomato"]}},console.log(a.toggle),a.togglePrint=["golden","popcorn cornel"],a.toggleMatch=function(a,b,c){for(var d in b)console.log(b[d]),null!=b[d].hit.exec(a)&&(c=b[d].result);return c}}]),myApp.controller("UserController",["$scope","$http","$location","$mdDialog","$mdMedia","$location","RSJService",function(a,b,c,d,e,c,f){var g=this,h=f;g.login=h.login,g.createUser=h.createUser,g.user=h.user,h.loginStatus(),h.autoTestLogin(),g.goToCreateUser=function(){d.hide(),d.show({templateUrl:"assets/views/newuser.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1})},g.goToLogin=function(){d.hide(),h.showLoginDialog()}}]),myApp.factory("AdminService",["$http",function(a){var b=function(){a.get("/auth/user/admin/questions").then(function(a){g.questions=a.data})},c=function(c){a.post("/auth/user/admin/newquestion",c).then(function(a){b()})},d=function(){a.get("/auth/user/admin/pages").then(function(a){g.pages=a.data})},e=function(b){a.post("/auth/user/admin/newpage",b).then(function(a){d()})},f=function(){void 0===g.questions&&b()},g={};return{getQuestions:b,submitNewQuestion:c,getPages:d,submitNewPage:e,initialCall:f,admin:g}}]),myApp.factory("RSJService",["$http","$mdDialog","$mdToast","$location",function(a,b,c,d){var e={},f={},g={},h=function(){console.log("getPages fired"),f.data||a.get("/auth/user/pages").then(function(a){f.data=a.data,console.log("rsjService.pages.data :",f.data)})},i=function(){return console.log("refreshPages fired"),a.get("/auth/user/pages").then(function(a){return f.data=a.data,console.log("rsjService.pages.data :",f.data),f.data})},j=function(){return console.log("refreshUserData fired"),a.get("/auth/user/data").then(function(a){return e.data=a.data,console.log("rsjService.user.data :",e.data),e.data})},k=function(){console.log("initialUserData fired"),f.data||a.get("/auth/user/data").then(function(a){e.data=a.data,console.log("rsjService.user.data :",e.data)})},l=function(b){return console.log("postUserData fired and sent:",b),a.post("/auth/user/data",b).then(function(a){return e.data=a.data,console.log("postUserData: rsjService.user.data was refreshed:",e.data),e.data})},m=function(b){return console.log("autoSaveAnswers fired and sent:",b),a.post("/auth/user/autosave",b).then(function(a){return e.data=a.data,console.log("autoSaveAnswers: jService.user.data was refreshed:",e.data),e.data})},n=function(b){return console.log("saveNewQuestion fired and sent:",b),a.post("/auth/user/newquestion",b).then(function(a){return e.data=a.data,console.log("saveNewQuestion: rsjService.user.data was refreshed:",e.data),e.data})},o=function(b){return console.log("saveNewBook fired and sent:",b),a.post("/auth/user/newbook",b).then(function(a){return e.data=a.data,console.log("saveNewBook: rsjService.user.data was refreshed:",e.data),e.data})},p=function(b){return console.log("saveNewPage fired and sent:",b),a.post("/auth/user/newpage",b).then(function(a){return e.data=a.data,console.log("saveNewPage: rsjService.user.data was refreshed:",e.data),e.data})},q=function(b){console.log("autoSaveCurrentPage fired"),a.post("/auth/user/currentpage",b).then(function(a){console.log("autoSaveCurrentPage responded")})},r=function(){console.log("checking user login status"),a.get("/login").then(function(a){a.data._id?(console.log("LOGGED IN! ",a.data),e.isLoggedIn=!0,e.data=a.data,h(),b.hide()):(console.log("NOT LOGGED IN!"),e.isLoggedIn=!1,s())})},s=function(a){b.show({templateUrl:"assets/views/welcome.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!1})},t={},u=function(c){console.log("login fired",c),a.post("/login",c).then(function(a){console.log(a),"password"==a.data[0]&&(t.password=!0),"email"==a.data[0]&&(t.email=!0),a.data._id&&(console.log("logged in"),e.isLoggedIn=!0,e.data=a.data,d.path("/library"),h(),b.hide())})},v=function(){var c={email:"cpeaslee@gmail.com",password:"asdfasdf"};console.log("admin cheat login fired",c),a.post("/login",c).then(function(a){a.data._id&&(console.log("logged in"),e.isLoggedIn=!0,e.data=a.data,d.path("/library"),h(),b.hide())})},w=function(b){console.log("createUser fired"),a.post("/register",b).then(function(a){a.data._id?(console.log("user was created"),x(),setTimeout(u(a.config.data),1e3)):console.log("no user?",a)})},x=function(a){c.show(c.simple().textContent("User Created. Now logging in...").position("bottom").parent(angular.element(document.getElementsByClassName("login-box"))))};return{initialPageGet:h,refreshPages:i,initialUserData:k,refreshUserData:j,loginStatus:r,login:u,createUser:w,postUserData:l,user:e,pages:f,site:g,autoSaveAnswers:m,autoSaveCurrentPage:q,loginAlert:t,autoTestLogin:v,saveNewQuestion:n,saveNewBook:o,saveNewPage:p}}]);